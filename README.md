# Roomberg Heatmap (Kuoni x HotelMap)

This repo is a Next.js app that renders a pricing heatmap from CSV output batches.
It reads data from `output_sheets/<batch>/pricing_hotels_all.csv`, normalizes the
`price` column, and displays a sortable, color-coded table plus summary stats.

## Data expectations

- **Batch folder:** `output_sheets/<batch>/pricing_hotels_all.csv` â€“ generated by roomberg
- **CSV columns:** `hmid`, `check_in`, `price` (others are ignored)
- **Summary file (optional):** `web/reference_sheets/kuoni_hotel_summary.csv` with
  `hmid` and `city` columns



If no batch is found, the UI will show a "No data found" message.


## How it works
- **Batch selection:** The app auto-picks the latest batch folder named like
  `YYYY_mon_DD` (example: `2026_jan_12`). You can override with
  `?batch=YYYY_mon_DD`.
- **Normalization:** `price` values can be numeric, "NA", "No rates found", or
  a Python dict string. Values are parsed and converted into a percent delta for
  the heatmap.
- **Coverage:** Coverage is computed per hotel as a ratio of non-NA/error cells.
- **Optional city lookup:** If `web/reference_sheets/kuoni_hotel_summary.csv` exists,
  it maps `hmid` to `city`.

## Project layout
- `web/` - Next.js app (App Router).
- `output_sheets/` - Batch data directory read by the app.
- `web/reference_sheets/` - Reference data (city lookup).

## Local usage (Node)
From the repo root:

```sh
cd web
npm install
npm run dev
```

Open `http://localhost:3000` (or `?batch=2026_jan_12` to pick a specific batch).
